{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{Link,useSearchParams}from\"react-router-dom\";import{motion}from\"framer-motion\";import{CheckCircle,Loader2}from\"lucide-react\";import{Button}from\"../components/ui/button\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BACKEND_URL=process.env.REACT_APP_BACKEND_URL;const API=\"\".concat(BACKEND_URL,\"/api\");const SuccessPage=()=>{const[searchParams]=useSearchParams();const[status,setStatus]=useState(\"checking\");const[attempts,setAttempts]=useState(0);const maxAttempts=5;const sessionId=searchParams.get(\"session_id\");useEffect(()=>{if(!sessionId){setStatus(\"error\");return;}const pollPaymentStatus=async function(){let attempt=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(attempt>=maxAttempts){setStatus(\"timeout\");return;}try{const response=await fetch(\"\".concat(API,\"/checkout/status/\").concat(sessionId));if(!response.ok)throw new Error(\"Failed to check payment status\");const data=await response.json();if(data.payment_status===\"paid\"){setStatus(\"success\");}else if(data.status===\"expired\"){setStatus(\"expired\");}else{setAttempts(attempt+1);setTimeout(()=>pollPaymentStatus(attempt+1),2000);}}catch(error){console.error(\"Error checking payment status:\",error);setStatus(\"error\");}};pollPaymentStatus();},[sessionId]);return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-background flex items-center justify-center px-6\",\"data-testid\":\"success-page\",children:/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"max-w-md w-full text-center\",children:[status===\"checking\"&&/*#__PURE__*/_jsxs(\"div\",{\"data-testid\":\"checking-status\",children:[/*#__PURE__*/_jsx(Loader2,{className:\"h-16 w-16 mx-auto mb-6 animate-spin text-accent\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-4\",children:\"Processing Payment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground mb-6\",children:\"Please wait while we confirm your payment...\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-muted-foreground\",children:[\"Attempt \",attempts+1,\" of \",maxAttempts]})]}),status===\"success\"&&/*#__PURE__*/_jsxs(\"div\",{\"data-testid\":\"success-status\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"h-16 w-16 mx-auto mb-6 text-accent\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-4\",children:\"Payment Successful!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground mb-8\",children:\"Thank you for your purchase. Your premium access has been activated.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(Button,{className:\"rounded-md\",\"data-testid\":\"return-home-button\",children:\"Return to Home\"})})]}),status===\"timeout\"&&/*#__PURE__*/_jsxs(\"div\",{\"data-testid\":\"timeout-status\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-4\",children:\"Payment Check Timeout\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground mb-8\",children:\"We're still processing your payment. Please check your email for confirmation.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(Button,{className:\"rounded-md\",\"data-testid\":\"return-home-button\",children:\"Return to Home\"})})]}),(status===\"error\"||status===\"expired\")&&/*#__PURE__*/_jsxs(\"div\",{\"data-testid\":\"error-status\",children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold mb-4\",children:[\"Payment \",status===\"expired\"?\"Expired\":\"Error\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground mb-8\",children:status===\"expired\"?\"Your payment session has expired. Please try again.\":\"There was an error processing your payment. Please try again.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(Button,{className:\"rounded-md\",\"data-testid\":\"return-home-button\",children:\"Return to Home\"})})]})]})});};export default SuccessPage;","map":{"version":3,"names":["React","useEffect","useState","Link","useSearchParams","motion","CheckCircle","Loader2","Button","jsx","_jsx","jsxs","_jsxs","BACKEND_URL","process","env","REACT_APP_BACKEND_URL","API","concat","SuccessPage","searchParams","status","setStatus","attempts","setAttempts","maxAttempts","sessionId","get","pollPaymentStatus","attempt","arguments","length","undefined","response","fetch","ok","Error","data","json","payment_status","setTimeout","error","console","className","children","div","initial","opacity","y","animate","to"],"sources":["C:/Users/RuanB/Documents/Projetos/Sevenxmidia/frontend/src/pages/SuccessPage.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Link, useSearchParams } from \"react-router-dom\";\nimport { motion } from \"framer-motion\";\nimport { CheckCircle, Loader2 } from \"lucide-react\";\nimport { Button } from \"../components/ui/button\";\n\nconst BACKEND_URL = process.env.REACT_APP_BACKEND_URL;\nconst API = `${BACKEND_URL}/api`;\n\nconst SuccessPage = () => {\n  const [searchParams] = useSearchParams();\n  const [status, setStatus] = useState(\"checking\");\n  const [attempts, setAttempts] = useState(0);\n  const maxAttempts = 5;\n  const sessionId = searchParams.get(\"session_id\");\n\n  useEffect(() => {\n    if (!sessionId) {\n      setStatus(\"error\");\n      return;\n    }\n\n    const pollPaymentStatus = async (attempt = 0) => {\n      if (attempt >= maxAttempts) {\n        setStatus(\"timeout\");\n        return;\n      }\n\n      try {\n        const response = await fetch(`${API}/checkout/status/${sessionId}`);\n        if (!response.ok) throw new Error(\"Failed to check payment status\");\n\n        const data = await response.json();\n\n        if (data.payment_status === \"paid\") {\n          setStatus(\"success\");\n        } else if (data.status === \"expired\") {\n          setStatus(\"expired\");\n        } else {\n          setAttempts(attempt + 1);\n          setTimeout(() => pollPaymentStatus(attempt + 1), 2000);\n        }\n      } catch (error) {\n        console.error(\"Error checking payment status:\", error);\n        setStatus(\"error\");\n      }\n    };\n\n    pollPaymentStatus();\n  }, [sessionId]);\n\n  return (\n    <div className=\"min-h-screen bg-background flex items-center justify-center px-6\" data-testid=\"success-page\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"max-w-md w-full text-center\"\n      >\n        {status === \"checking\" && (\n          <div data-testid=\"checking-status\">\n            <Loader2 className=\"h-16 w-16 mx-auto mb-6 animate-spin text-accent\" />\n            <h1 className=\"text-3xl font-bold mb-4\">Processing Payment</h1>\n            <p className=\"text-muted-foreground mb-6\">\n              Please wait while we confirm your payment...\n            </p>\n            <p className=\"text-sm text-muted-foreground\">\n              Attempt {attempts + 1} of {maxAttempts}\n            </p>\n          </div>\n        )}\n\n        {status === \"success\" && (\n          <div data-testid=\"success-status\">\n            <CheckCircle className=\"h-16 w-16 mx-auto mb-6 text-accent\" />\n            <h1 className=\"text-3xl font-bold mb-4\">Payment Successful!</h1>\n            <p className=\"text-muted-foreground mb-8\">\n              Thank you for your purchase. Your premium access has been activated.\n            </p>\n            <Link to=\"/\">\n              <Button className=\"rounded-md\" data-testid=\"return-home-button\">\n                Return to Home\n              </Button>\n            </Link>\n          </div>\n        )}\n\n        {status === \"timeout\" && (\n          <div data-testid=\"timeout-status\">\n            <h1 className=\"text-3xl font-bold mb-4\">Payment Check Timeout</h1>\n            <p className=\"text-muted-foreground mb-8\">\n              We're still processing your payment. Please check your email for confirmation.\n            </p>\n            <Link to=\"/\">\n              <Button className=\"rounded-md\" data-testid=\"return-home-button\">\n                Return to Home\n              </Button>\n            </Link>\n          </div>\n        )}\n\n        {(status === \"error\" || status === \"expired\") && (\n          <div data-testid=\"error-status\">\n            <h1 className=\"text-3xl font-bold mb-4\">Payment {status === \"expired\" ? \"Expired\" : \"Error\"}</h1>\n            <p className=\"text-muted-foreground mb-8\">\n              {status === \"expired\"\n                ? \"Your payment session has expired. Please try again.\"\n                : \"There was an error processing your payment. Please try again.\"}\n            </p>\n            <Link to=\"/\">\n              <Button className=\"rounded-md\" data-testid=\"return-home-button\">\n                Return to Home\n              </Button>\n            </Link>\n          </div>\n        )}\n      </motion.div>\n    </div>\n  );\n};\n\nexport default SuccessPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}